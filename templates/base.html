<!DOCTYPE html>
<html lang="hr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Napomene</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
    <h1>ğŸ“ Napomene</h1>

    <div style="display:flex; gap:12px; align-items:center;">
        <span id="userEmail" style="font-size:14px; opacity:0.8;"></span>

        <a href="/login"
           id="loginLink"
           style="font-size:14px; text-decoration:none;">
            Login
        </a>

        <a href="#"
           id="logoutLink"
           style="font-size:14px; text-decoration:none; color:var(--danger); display:none;">
            Logout
        </a>

        <button id="themeToggle" class="theme-toggle">ğŸŒ™</button>
    </div>
</header>

<main>
    {% block content %}{% endblock %}
</main>

<button id="addBtn" class="fab">+</button>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://XXXX.supabase.co";
const SUPABASE_ANON_KEY = "XXXX";

const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
);

// UI auth state
async function initAuthUI() {
    const { data } = await supabaseClient.auth.getUser();

    const userEmail = document.getElementById("userEmail");
    const loginLink = document.getElementById("loginLink");
    const logoutLink = document.getElementById("logoutLink");

    if (data.user) {
        userEmail.textContent = "ğŸ‘¤ " + data.user.email;
        loginLink.style.display = "none";
        logoutLink.style.display = "inline";
    } else {
        userEmail.textContent = "";
        loginLink.style.display = "inline";
        logoutLink.style.display = "none";
    }
}

document.getElementById("logoutLink").addEventListener("click", async (e) => {
    e.preventDefault();
    await supabaseClient.auth.signOut();
    window.location.href = "/login";
});

initAuthUI();
</script>

<script>
    // Dark mode toggle
    const root = document.documentElement;
    const toggleBtn = document.getElementById("themeToggle");

    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
        root.setAttribute("data-theme", savedTheme);
        toggleBtn.textContent = savedTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
    }

    toggleBtn.addEventListener("click", () => {
        const current = root.getAttribute("data-theme");
        const next = current === "dark" ? "light" : "dark";
        root.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
        toggleBtn.textContent = next === "dark" ? "â˜€ï¸" : "ğŸŒ™";
    });

    // Add form toggle
    const addBtn = document.getElementById("addBtn");
    const form = document.getElementById("addForm");
    const textarea = document.getElementById("noteText");

    if (addBtn && form && textarea) {
        addBtn.addEventListener("click", () => {
            form.classList.toggle("show");
            textarea.focus();
        });
    }
</script>

{% block scripts %}{% endblock %}

</body>
</html>
